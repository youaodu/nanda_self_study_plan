# 第二章

**处理器的构成与基本工作方式**

处理器构成：

​		运算器、控制器、一系列寄存器和高速缓存。

​		运算器：

​				实现算数与逻辑运算。

​		控制器：

​				控制程序运行流程。

​		寄存器：

​				用于处理执行指令的过程中暂存的数据、地址和指令信息。

​		高速缓存：

​				为CPU和内存提供一个高速的数据缓存位置。

处理器的工作状态

​		工作状态分为：管态、目态。

​		管态：

​				操作系统管理程序运行的状态，又称内核态、系统态等，具有较高特权。

​		目态：

​				一般用户程序运行时的状态，又称为用户态、普通态，具有较低特权。

​		工作状态转换：

​				目态到管态的转换：唯一的途径是通过中断。中断响应式交换中断向量，新的中断向量的PSW的处理器状态标志位管态。

​				管态到目态的装换：可通过设置PSW指令，实现从操作系统到用户程序的转换。

------

**寄存器分类**

用户可见寄存器：

​		由编译程序分配，减少程序运行时效和访问内存次数。

​		包括：数据寄存器、地址寄存器、条件码寄存器。

控制和状态寄存器

​		控制处理器的操作。

​		常见：程序计数器（PC）、指令寄存器（IR）、程序状态字（PSW）

----

**指令**

指令执行过程

​		简易：

​			1.读取指令，并将程序计数器的值变成下一条指令的地址。

​			2.指令放入指令寄存器中，处理解释并执行该指令。

​		复杂：



特权指令和非特权指令

​		在多道程序环境下，指令分为特权指令和非特权指令。

​		特权指令：

​				1）在操作系统中那些只能由操作系统使用的指令。

​				2）不允许一般用户使用。

​							如：设置程序状态字、启动某设备、设置中断屏蔽字。

​		非特权指令

​				普通用户使用的指令。

----

**程序状态字**

程序状态字一般包括：

​		CPU的工作状态代码：指明当前工作状态是管态还是目态。

​		条件码：反应指令执行后的结果特征，比如结果为0等。

​		中断屏蔽码：指出是否允许中断。

---

**存储器**

存储器分两类：

​		1）类型存储器：

​				读写型存储器（RAM），用来存储随机存取的程序和数据。

​				只读存储器（ROM），存放一些固化的程序。

​		2）存储分块

​				存储的最小单位：位(bit)

​				最小编制单位：字节

​				分块：为了分配喝管理方便，将内存划分位大小相等的块（物理页Page）,以块为单位分配内存空间，大				小一般为512B，1KB，4KB，8KB等。

存储器的层次结构(容量、速度、成本)

​		1.寄存器

​		2.高速缓存

​		3.内存储器

​		4.磁盘存储器

​		5.云存储

存储器保护

​	多道程序设计系统中，保证每个程序独立运行、互不干扰，称为存储器保护。

​	方法：界地址寄存器

----

**时钟部件**

功能：

​		1.发现死循环，防止机时的浪费

​		2.分时系统中，时钟间隔实现时间片轮转执行

​		3.实时系统中，按要求的时间间隔控制设备

​		4.定时唤醒各个外部事件。

​		5.记录各种设备的使用时间和某外部事件发生的事件

​		6.记录用户和系统所需的绝对时间，即年、月、日

分类：

​	硬件时钟和软件时钟

​	用途分类：绝对时钟和相对时钟

----

**中断机制**

中断和异常：

​		中断：指处理器对系统中或系统外发生的异步事件的响应。

​		异步事件：指无一定时序关系的随机发生事件，如外部设备完成了数据传输任务，某一实时控制设备处现异		常情况等。

中断与异常的概念

​		中断相关概念：

​				中断源：引起中断的事件称为中断事件或中断源。

​				中断请求：中断源向处理器发出的请求信号。

​				中断处理程序：处理中断事件的程序。

​				断点：发生中断是正在执行的程序的暂停点。

​				中断响应：处理器暂停当前程序转而处理中断的程序。

​				中断返回：中断处理程序结束后回复原来程序的执行。

​				中断向量表：为了使得中断装置可以找到恰当的中断处理程序，专门设计了中断处理程序的入口地址映		射表，又称中断向量表。

​				异常：有正在执行的指令引发的中断。

​		

​	中断和异常的分类

​			典型的中断：时钟中断、输入输出中断、控制台中断、硬件故障中断。

​			典型的异常：程序性中断，访管指令异常。



```
	典型中断：
​		1.I\O中断
​		2.时钟中断
​		3.硬件故障中断
​		4.程序性中断
​		5.系统服务请求中断
# 1-4属于强迫性中断，5属于自愿性中断
强迫性中断：不知道什么时候发生，和发生缘由都要处理
自愿性中断：系统知道，到这一步会发生中断，然后处理 
```



中断系统

​		中断请求的接收：

​				中断系统如何接受中断源的中断请求，因机器而异。

​				一般由中断逻辑线路和中断寄存器实现。



中断响应的过程：

​		1.处理器接收中断信号。

​		2.保护现场（CPU，寄存器，系统堆栈内容）

​		3.分析中断向量

​		4.讲处理器的PC值置为中断程序的入口地址

​		5.调用中断处理程序。



中断优先级：

​		



中断处理过程：

​		1.接收和响应中断

​		2.保护中断断点现场

​		3.分析中断向量，调用中断处理程序

​		4.中断处理结束恢复现场，原有程序继续执行

----

**系统调用**

​		概念：

​				用户在程序中调用操作系统提供的一些功能，是操作系统提供给编程人员的唯一接口。

​				是一种特殊的过程调用，由特殊的机器指令实现，这条指令将系统转入管态



​		系统调用与函数调用的区别：

​				1.运行在不同的状态（系统调用，管态，函数调用目态）

​				2.状态的转换（系统调用会转回状态，过程：目态->管态->目态）

​				3.返回问题

​				4.嵌套调用（都允许嵌套，但是系统调用有嵌套层级限制4-5层左右，函数调用理论无线）



​		分类：

​				1.进程控制类

​				2.文件操作类

​				3.进程通信类

​				4.设备管理类

​				5.信息维护类